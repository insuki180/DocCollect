<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>DocCollect HR</title>

<style>
:root{
--primary-color:#2563eb;
--success-color:#10b981;
--bg:#f4f6f8;
--card:#ffffff;
--text:#1f2937;
--muted:#6b7280;
--border:#e5e7eb;
}

body{
margin:0;
font-family:'Segoe UI',sans-serif;
background:var(--bg);
padding:15px;
line-height:1.5;
}

.container{
max-width:650px;
margin:auto;
background:var(--card);
padding:25px;
border-radius:16px;
box-shadow:0 8px 25px rgba(0,0,0,.06);
}

/* Spinner Overlay */
#loadingOverlay{
display:none;
position:fixed;
inset:0;
background:rgba(255,255,255,.95);
z-index:1000;
align-items:center;
justify-content:center;
flex-direction:column;
}

.spinner{
border:4px solid #f3f3f3;
border-top:4px solid var(--primary-color);
border-radius:50%;
width:45px;
height:45px;
animation:spin 1s linear infinite;
margin-bottom:15px;
}
@keyframes spin{
0%{transform:rotate(0deg);}
100%{transform:rotate(360deg);}
}

.header{text-align:center;margin-bottom:25px;}
.header img{max-height:60px;max-width:200px;object-fit:contain;margin-bottom:12px;}
.header h1{margin:0;font-size:20px;font-weight:700;}
.header p{margin:4px 0 0;color:var(--muted);font-size:13px;}

.section-title{
font-size:12px;
text-transform:uppercase;
letter-spacing:1px;
font-weight:700;
color:var(--muted);
margin:25px 0 12px;
border-bottom:1px solid var(--border);
padding-bottom:6px;
}

label{
display:block;
font-size:13px;
font-weight:600;
margin-top:14px;
margin-bottom:6px;
}

input,select{
width:100%;
padding:13px;
border:1px solid var(--border);
border-radius:12px;
font-size:15px;
box-sizing:border-box;
}

input:focus,select:focus{
outline:none;
border-color:var(--primary-color);
box-shadow:0 0 0 3px rgba(37,99,235,.1);
}

.flex-row{display:flex;gap:12px;}
.flex-row>div{flex:1;}

.upload-input{display:none;}

.upload-label{
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
padding:25px;
border:2px dashed var(--border);
border-radius:14px;
background:#fafafa;
text-align:center;
cursor:pointer;
transition:.25s;
}

.upload-label.dragover{
border-color:var(--primary-color);
background:#f0f7ff;
}

.file-feedback{
display:none;
margin-top:10px;
padding:10px 15px;
background:#ecfdf5;
border:1px solid #d1fae5;
border-radius:8px;
font-size:13px;
color:#065f46;
}

.progress-container{
display:none;
margin-top:20px;
}

.progress-bar{
height:10px;
background:#e5e7eb;
border-radius:6px;
overflow:hidden;
}

.progress-fill{
height:100%;
width:0%;
background:var(--primary-color);
transition:width .3s ease;
}

.submit-btn{
margin-top:25px;
width:100%;
padding:16px;
background:var(--primary-color);
color:#fff;
border:none;
border-radius:14px;
font-size:16px;
font-weight:700;
cursor:pointer;
}

.submit-btn:disabled{
background:#9ca3af;
cursor:not-allowed;
}

.success-screen{
display:none;
text-align:center;
padding:40px 20px;
}

.success-screen h2{
color:var(--success-color);
margin-bottom:10px;
}

.success-screen button{
margin-top:20px;
padding:12px 20px;
border:none;
background:var(--primary-color);
color:#fff;
border-radius:10px;
font-weight:600;
}

.footer{text-align:center;margin-top:18px;font-size:12px;color:#9ca3af;}
</style>
</head>
<body>

<div id="loadingOverlay">
<div class="spinner"></div>
<h3>Processing Files...</h3>
<p style="color:#666;font-size:14px;">Preparing documents securely.</p>
</div>

<div class="container">

<div id="formContainer">

<div class="header">
<div id="brandLogo"></div>
<h1 id="companyName"></h1>
<p id="formTitle"></p>
</div>

<form id="docCollectForm">

<div class="section-title">Personal Details</div>

<label>Full Name *</label>
<input type="text" name="name" required placeholder="Enter your full name">

<label>Mobile Number *</label>
<input type="tel" name="phone" required placeholder="98765 43210">

<label>Email *</label>
<input type="email" name="email" required placeholder="john@email.com">

<div class="section-title">Job & Experience</div>

<label>Applying For *</label>
<input type="text" name="role" placeholder="Full Stack Developer">

<label>Years of Experience *</label>
<select id="experience" name="experience" required>
<option value="">Select</option>
<option value="Fresher">Fresher (0 Years)</option>
<option value="0-1">0 - 1 Years</option>
<option value="1-3">1 - 3 Years</option>
<option value="3-5">3 - 5 Years</option>
<option value="5+">5+ Years</option>
</select>

<label>Current Location *</label>
<input type="text" name="location" required placeholder="Current City">

<div id="professionalSection">

<div class="section-title">Professional Details</div>

<div class="flex-row">
<div>
<label>Current CTC (LPA)</label>
<input type="text" name="current_ctc" placeholder="4.5">
</div>
<div>
<label>Expected CTC</label>
<input type="text" name="expected_ctc" placeholder="6.0">
</div>
</div>

<label>Notice Period</label>
<select name="notice_period">
<option value="">Select Notice Period</option>
<option>Immediate</option>
<option>15 Days</option>
<option>30 Days</option>
<option>60 Days</option>
<option>90 Days</option>
</select>

</div>

<div class="section-title">Documents</div>

<label>Resume (PDF Only) *</label>
<input type="file" id="resumeFile" accept="application/pdf" class="upload-input" required>
<label for="resumeFile" class="upload-label" id="resumeDrop">
Upload Resume (PDF only, Max 5MB)
</label>
<div id="resumeFeedback" class="file-feedback"></div>

<label>Other Documents (Optional)</label>
<input type="file" id="otherFiles" multiple accept=".pdf,.jpg,.jpeg,.png" class="upload-input">
<label for="otherFiles" class="upload-label" id="otherDrop">
Certificates / ID Proof
</label>
<div id="otherFeedback" class="file-feedback"></div>

<div class="progress-container" id="progressContainer">
<div class="progress-bar">
<div class="progress-fill" id="progressFill"></div>
</div>
</div>

<button type="submit" class="submit-btn" id="submitBtn">Submit Application</button>

</form>

<div class="footer">Powered by DocCollect</div>

</div>

<div class="success-screen" id="successScreen">
<h2>Application Submitted Successfully üéâ</h2>
<p id="successMessage"></p>
<button onclick="location.reload()">Submit Another Application</button>
</div>

</div>

<script>
let SCRIPT_URL=null,API_KEY=null,companyKey=null;

async function loadBranding(){
const params=new URLSearchParams(window.location.search);
companyKey=params.get("company");
if(!companyKey)return;
const res=await fetch("companies.json");
const companies=await res.json();
const config=companies[companyKey];
document.getElementById("companyName").textContent=config.companyName;
document.getElementById("formTitle").textContent=config.formTitle;
if(config.logoUrl)
document.getElementById("brandLogo").innerHTML=`<img src="${config.logoUrl}">`;
document.documentElement.style.setProperty('--primary-color',config.primaryColor);
SCRIPT_URL=config.scriptUrl;
API_KEY=config.apiKey;
}
loadBranding();

/* Fresher toggle */
document.getElementById('experience').addEventListener('change',function(){
const section=document.getElementById('professionalSection');
if(this.value==="Fresher"){
section.style.opacity='.5';
section.style.pointerEvents='none';
section.querySelectorAll('input,select').forEach(i=>i.value="");
}else{
section.style.opacity='1';
section.style.pointerEvents='auto';
}
});

/* Drag-drop */
function setupDrop(input,label){
label.addEventListener('dragover',e=>{
e.preventDefault();
label.classList.add('dragover');
});
label.addEventListener('dragleave',()=>label.classList.remove('dragover'));
label.addEventListener('drop',e=>{
e.preventDefault();
label.classList.remove('dragover');
input.files=e.dataTransfer.files;
input.dispatchEvent(new Event('change'));
});
}
setupDrop(resumeFile,resumeDrop);
setupDrop(otherFiles,otherDrop);

/* Upload Handlers */
resumeFile.addEventListener('change',function(){
if(this.files[0]){
resumeFeedback.style.display='block';
resumeFeedback.textContent="üìÑ "+this.files[0].name;
}
});
otherFiles.addEventListener('change',function(){
if(this.files.length>0){
otherFeedback.style.display='block';
otherFeedback.textContent="üóÇÔ∏è "+this.files.length+" files selected";
}
});

/* Submit */
const form=document.getElementById('docCollectForm');
const overlay=document.getElementById('loadingOverlay');
const submitBtn=document.getElementById('submitBtn');
const progressFill=document.getElementById('progressFill');
const progressContainer=document.getElementById('progressContainer');

form.addEventListener('submit',async function(e){
e.preventDefault();
if(!SCRIPT_URL||!API_KEY)return;

overlay.style.display='flex';
submitBtn.disabled=true;

try{
const resumeB64=await toBase64(resumeFile.files[0]);

let otherDocsArray=[];
for(let i=0;i<otherFiles.files.length;i++){
const file=otherFiles.files[i];
const b64=await toBase64(file);
otherDocsArray.push({name:file.name,mimeType:file.type,data:b64});
}

overlay.style.display='none';
progressContainer.style.display='block';
progressFill.style.width='30%';

const payload={
apiKey:API_KEY,
company:companyKey,
name:form.name.value,
phone:form.phone.value,
email:form.email.value,
role:form.role.value,
experience:form.experience.value,
location:form.location.value,
current_ctc:form.current_ctc.value||'',
expected_ctc:form.expected_ctc.value||'',
notice_period:form.notice_period.value||'',
resume:{name:resumeFile.files[0].name,mimeType:resumeFile.files[0].type,data:resumeB64},
other_docs:otherDocsArray
};

const response=await fetch(SCRIPT_URL,{method:'POST',body:JSON.stringify(payload)});
const result=await response.json();

progressFill.style.width='100%';

if(result.status==='success'){
document.getElementById("formContainer").style.display='none';
document.getElementById("successScreen").style.display='block';
document.getElementById("successMessage").innerText=
`Thank you for applying to ${document.getElementById("companyName").innerText}.`;
}else{
throw new Error(result.message);
}

}catch(err){
alert("Submission Failed: "+err.message);
}finally{
submitBtn.disabled=false;
}
});

const toBase64=file=>new Promise((resolve,reject)=>{
const reader=new FileReader();
reader.readAsDataURL(file);
reader.onload=()=>resolve(reader.result.split(',')[1]);
reader.onerror=reject;
});
</script>

</body>
</html>